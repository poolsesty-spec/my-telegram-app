<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background-color: #f7f3e9; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; color: #333; }
        .header-card { background: white; border-radius: 25px; padding: 25px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .goal-label { font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 600; }
        .goal-text { font-size: 22px; font-weight: 800; margin-top: 8px; color: #2c3e50; }
        
        .stats-row { display: flex; background: white; border-radius: 20px; padding: 15px; justify-content: space-around; align-items: center; margin-bottom: 20px; }
        .stat-item { text-align: center; }
        .stat-val { font-size: 20px; font-weight: bold; display: block; color: #2c3e50; }
        .stat-lbl { font-size: 12px; color: #888; margin-bottom: 4px; display: block; }
        
        .progress-circle { width: 65px; height: 65px; border-radius: 50%; border: 6px solid #e8f5e9; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #4caf50; font-size: 14px; background: white; box-shadow: inset 0 0 10px rgba(76,175,80,0.1); }
        
        .tasks-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .task-card { background: white; border-radius: 22px; padding: 18px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.03); transition: 0.3s; position: relative; overflow: hidden; }
        .task-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 5px; background: #a8e0b3; }
        .task-icon { font-size: 30px; margin-bottom: 10px; display: block; }
        .task-name { font-size: 14px; font-weight: 600; color: #444; margin-bottom: 12px; height: 34px; line-height: 1.2; display: flex; align-items: center; justify-content: center; }
        .btn-done { background: #e8f5e9; color: #2e7d32; border: none; padding: 8px 0; border-radius: 12px; font-size: 13px; font-weight: 700; width: 100%; cursor: pointer; transition: 0.2s; }
        .btn-done:active { transform: scale(0.95); }
        .btn-done.completed { background: #f5f5f5; color: #bbb; cursor: default; }
    </style>
</head>
<body>
    <div class="header-card">
        <div class="goal-label">–ú–æ—è –≥–ª–∞–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Ü–µ–ª—å:</div>
        <div class="goal-text" id="goal-val">...</div>
    </div>

    <div class="stats-row">
        <div class="stat-item"><span class="stat-lbl">–û—á–∫–∏</span><span class="stat-val" id="points-val">0</span></div>
        <div class="progress-circle" id="perc-val">0%</div>
        <div class="stat-item"><span class="stat-lbl">–†–æ—Å—Ç</span><span class="stat-val">üå±</span></div>
    </div>

    <div class="tasks-grid" id="tasks-container"></div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = '#f7f3e9';

        const params = new URLSearchParams(window.location.search);
        const tasks = JSON.parse(params.get('tasks') || "[]");
        
        document.getElementById('goal-val').innerText = params.get('goal') || "–¶–µ–ª—å –Ω–µ –∑–∞–¥–∞–Ω–∞";
        document.getElementById('points-val').innerText = params.get('points') || "0";

        const doneCount = tasks.filter(t => t.done).length;
        const progress = tasks.length > 0 ? Math.round((doneCount / tasks.length) * 100) : 0;
        document.getElementById('perc-val').innerText = progress + "%";

        const container = document.getElementById('tasks-container');
        tasks.forEach(task => {
            const card = document.createElement('div');
            card.className = 'task-card';
            if(task.done) card.style.opacity = '0.7';
            
            card.innerHTML = `
                <span class="task-icon">${task.icon}</span>
                <div class="task-name">${task.name}</div>
                <button class="btn-done ${task.done ? 'completed' : ''}" ${task.done ? 'disabled' : ''}>
                    ${task.done ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úì' : '–°–¥–µ–ª–∞–Ω–æ'}
                </button>
            `;
            
            if(!task.done) {
                card.querySelector('button').onclick = function() {
                    tg.sendData(JSON.stringify({action: "done", task: task.name}));
                    this.innerText = "–ó–∞–ø–∏—Å—å...";
                    this.disabled = true;
                };
            }
            container.appendChild(card);
        });
    </script>
</body>
</html>
