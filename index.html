<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.headerColor = '#f7f3e9';

    // Получаем данные из URL, которые передал Python-бот
    const params = new URLSearchParams(window.location.search);
    const goal = params.get('goal') || "Цель не установлена";
    const points = params.get('points') || "0";
    const tasks = JSON.parse(params.get('tasks') || "[]");
    
    // Заполняем поля
    document.getElementById('goal-val').innerText = goal;
    document.getElementById('points-val').innerText = points;

    // Считаем прогресс
    const doneCount = tasks.filter(t => t.done).length;
    const progress = tasks.length > 0 ? Math.round((doneCount / tasks.length) * 100) : 0;
    document.getElementById('perc-val').innerText = progress + "%";

    // Рисуем карточки задач
    const container = document.getElementById('tasks-container');
    container.innerHTML = ''; // Очистка
    
    tasks.forEach(task => {
        const card = document.createElement('div');
        card.className = 'task-card';
        if(task.done) card.style.opacity = '0.6';
        
        card.innerHTML = `
            <span class="task-icon">${task.icon}</span>
            <div class="task-name">${task.name}</div>
            <button class="btn-done ${task.done ? 'completed' : ''}" ${task.done ? 'disabled' : ''}>
                ${task.done ? 'Готово ✓' : 'Сделано'}
            </button>
        `;
        
        if(!task.done) {
            card.querySelector('button').onclick = function() {
                tg.sendData(JSON.stringify({action: "done", task: task.name}));
                this.innerText = "⏳...";
                this.disabled = true;
            };
        }
        container.appendChild(card);
    });
</script>
